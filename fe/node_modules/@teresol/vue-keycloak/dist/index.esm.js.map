{"version":3,"file":"index.esm.js","sources":["../dist-transpiled/state.js","../dist-transpiled/utils.js","../dist-transpiled/keycloak.js","../dist-transpiled/composable.js","../dist-transpiled/const.js","../dist-transpiled/config.js","../dist-transpiled/plugin.js"],"sourcesContent":["import { reactive } from 'vue';\nimport jwtDecode from 'jwt-decode';\nexport const state = reactive({\n    isAuthenticated: false,\n    hasFailed: false,\n    isPending: false,\n    token: '',\n    decodedToken: {},\n    username: '',\n    roles: [],\n    resourceRoles: {},\n});\nexport const setToken = (token) => {\n    state.token = token;\n    const content = jwtDecode(state.token);\n    state.decodedToken = content;\n    state.roles = content.realm_access.roles;\n    state.username = content.preferred_username;\n    state.resourceRoles = content.resource_access ? Object.fromEntries(Object.entries(content.resource_access).map(([key, value]) => [key, value.roles])) : {};\n};\nexport const hasFailed = (value) => {\n    state.hasFailed = value;\n};\nexport const isPending = (value) => {\n    state.isPending = value;\n};\nexport const isAuthenticated = (value) => {\n    state.isAuthenticated = value;\n};\n//# sourceMappingURL=state.js.map","// eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types, @typescript-eslint/no-explicit-any\nexport function isPromise(promise) {\n    return !isNil(promise) && typeof promise.then === 'function';\n}\n// eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types, @typescript-eslint/no-explicit-any\nexport function isFunction(fun) {\n    return !isNil(fun) && typeof fun === 'function';\n}\n// eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types, @typescript-eslint/no-explicit-any\nexport function isString(text) {\n    return !isNil(text) && (typeof text === 'string' || text instanceof String);\n}\n// eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types, @typescript-eslint/no-explicit-any\nexport function isNil(value) {\n    return value === undefined || value === null;\n}\n//# sourceMappingURL=utils.js.map","import Keycloak from 'keycloak-js';\nimport { hasFailed, isAuthenticated, isPending, setToken } from './state';\nimport { isNil } from './utils';\nlet $keycloak = undefined;\nexport async function isTokenReady() {\n    return new Promise(resolve => checkToken(resolve));\n}\nconst checkToken = (resolve) => {\n    if (!isNil($keycloak) && !isNil($keycloak.token)) {\n        resolve();\n    }\n    else {\n        setTimeout(() => checkToken(resolve), 500);\n    }\n};\nexport function getKeycloak() {\n    return $keycloak;\n}\nexport async function getToken() {\n    return updateToken();\n}\nexport async function isLoggedIn() {\n    try {\n        if (!$keycloak.authenticated) {\n            return false;\n        }\n        await this.updateToken();\n        return true;\n    }\n    catch (error) {\n        return false;\n    }\n}\nexport async function updateToken() {\n    if (!$keycloak) {\n        throw new Error('Keycloak is not initialized.');\n    }\n    try {\n        await $keycloak.updateToken(10);\n        setToken($keycloak.token);\n    }\n    catch (error) {\n        hasFailed(true);\n        throw new Error('Failed to refresh the token, or the session has expired');\n    }\n    return $keycloak.token;\n}\nexport function createKeycloak(config) {\n    $keycloak = Keycloak(config);\n    return getKeycloak();\n}\nexport async function initKeycloak(initConfig) {\n    try {\n        isPending(true);\n        const _isAuthenticated = await $keycloak.init(initConfig);\n        isAuthenticated(_isAuthenticated);\n        if (!isNil($keycloak.token)) {\n            setToken($keycloak.token);\n        }\n        $keycloak.onAuthRefreshSuccess = () => setToken($keycloak.token);\n        $keycloak.onTokenExpired = () => updateToken();\n    }\n    catch (error) {\n        hasFailed(true);\n        isAuthenticated(false);\n        throw new Error('Could not read access token');\n    }\n    finally {\n        isPending(false);\n    }\n}\n//# sourceMappingURL=keycloak.js.map","import { toRefs } from 'vue';\nimport { getKeycloak } from './keycloak';\nimport { state } from './state';\nimport { isNil } from './utils';\nexport const useKeycloak = () => {\n    return Object.assign(Object.assign({}, toRefs(state)), { keycloak: getKeycloak(), hasRoles: (roles) => !isNil(roles) && state.isAuthenticated && roles.every(role => state.roles.includes(role)), hasResourceRoles: (roles, resource) => !isNil(roles) &&\n            !isNil(resource) &&\n            state.isAuthenticated &&\n            roles.every(role => state.resourceRoles[resource].includes(role)) });\n};\n//# sourceMappingURL=composable.js.map","export const defaultInitConfig = {\n    flow: 'standard',\n    checkLoginIframe: false,\n    onLoad: 'login-required',\n};\n//# sourceMappingURL=const.js.map","export function loadJsonConfig(url) {\n    return new Promise((resolve, reject) => {\n        const xhttp = new XMLHttpRequest();\n        xhttp.overrideMimeType('application/json');\n        xhttp.onreadystatechange = function () {\n            if (this.readyState == 4 && this.status == 200) {\n                const jsonResponse = this.responseText;\n                const response = JSON.parse(jsonResponse);\n                resolve(response);\n            }\n            else {\n                reject('Could not load ' + url + ' file');\n            }\n        };\n        xhttp.open('GET', url, true);\n        xhttp.send();\n    });\n}\n//# sourceMappingURL=config.js.map","import { defaultInitConfig } from './const';\nimport { createKeycloak, initKeycloak } from './keycloak';\nimport { isPromise, isFunction, isNil, isString } from './utils';\nimport { loadJsonConfig } from './config';\nexport const vueKeycloak = {\n    async install(app, options) {\n        if (isNil(options)) {\n            throw new Error('The Keycloak.KeycloakConfig are requried');\n        }\n        let keycloakPluginConfig;\n        if (isString(options)) {\n            keycloakPluginConfig = await loadJsonConfig(options);\n        }\n        else if (isPromise(options) || isFunction(options)) {\n            keycloakPluginConfig = await options();\n        }\n        else {\n            keycloakPluginConfig = options;\n        }\n        const keycloakConfig = keycloakPluginConfig.config;\n        const keycloakInitOptions = !isNil(keycloakPluginConfig.initOptions)\n            ? Object.assign(Object.assign({}, defaultInitConfig), keycloakPluginConfig.initOptions) : defaultInitConfig;\n        const _keycloak = createKeycloak(keycloakConfig);\n        app.config.globalProperties.$keycloak = _keycloak;\n        await initKeycloak(keycloakInitOptions);\n    },\n};\n//# sourceMappingURL=plugin.js.map"],"names":[],"mappings":"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"}